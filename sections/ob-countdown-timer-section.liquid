{% assign section_classes = section.settings.section_custom_classes | default: '' %}

{% assign show_section = false %}
{% capture section_blocks_to_show %}
{% for block in section.blocks %}
  {%- comment %}<locksmith:ff85>{% endcomment -%}
    {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: block.settings.collection, subject_parent: section, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
  {%- comment %}</locksmith:ff85>{% endcomment -%}
  {%- capture show_block_markets -%}
    {%- render 'ob-process-show-on-by-market',
      show_on_all_markets: block.settings.show_on_all_markets,
      markets_to_show: block.settings.markets_to_show_on | split: ',',
      markets_to_exclude_on: block.settings.markets_to_exclude_on | split: ','
    -%}
  {% endcapture %}

  {%- capture show_block_collections -%}
    {%- render 'ob-collection-drop',
      show_on_all_collections: block.settings.show_on_all_collections,
      collection_lists_to_show_on: block.settings.collections_to_show_on_using_default_listed,
      collection_extas_to_show_on: block.settings.collections_to_show_on_extras,
      collection_lists_to_exclude_from: block.settings.collections_to_exclude_from_default_listed,
      collection_extas_to_exclude: block.settings.collections_to_exclude_from_extras
    -%}
  {% endcapture %}

  {% if show_block_markets contains "true" and show_block_collections contains "true" %}

    {% assign block_bg = block.settings.bg_color | default: section.settings.bg_color | default: 'transparent' %}
    {% assign block_text = block.settings.text_color | default: section.settings.text_color | default: 'inherit' %}
  <div class="w-full px-6 py-0.5 py-0 {{ section_classes }}" style="background-color: {{ block_bg }}; color: {{ block_text }};">
    <div class="max-w-3xl mx-auto text-center space-y-6">
    

    <div class="countdown-block {{ block.settings.custom_class }}">
      
      {% if block.settings.heading != blank %}
        <h2 class=" pb-0.5 text-left">{{ block.settings.heading }}</h2>
      {% endif %}

      {% if block.settings.paragraph_text != blank %}
        <p class="text-base sm:text-lg md:text-xl">{{ block.settings.paragraph_text }}</p>
      {% endif %}

      {% if block.settings.button_text != blank and block.settings.button_link != blank %}
        <a href="{{ block.settings.button_link }}" class="inline-block px-6 py-3 border border-current text-base font-semibold rounded hover:opacity-80 transition {{ block.settings.button_class }}">
          {{ block.settings.button_text }}
        </a>
      {% endif %}

      {% if block.settings.date != blank and block.settings.time != blank %}
        {% assign now = 'now' | date: '%Y-%m-%d %H:%M' %}
        {% assign target = block.settings.date | append: ' ' | append: block.settings.time %}
        {% assign datetime = target | date: '%Y-%m-%d %H:%M' %}
        {% if now < datetime %}
          <div class="count-down collection max-w-xs mx-auto pb-2" date-value="{{ block.settings.date }}" time-value="{{ block.settings.time }}">
            <div class="grid grid-cols-7 gap-x-2 sm:gap-x-4 md:gap-x-6 text-center {{ block.settings.number_class }}">
              <div class="days-input">00</div>
              <div class="time-sep">:</div>
              <div class="hours-input">00</div>
              <div class="time-sep">:</div>
              <div class="minutes-input">00</div>
              <div class="time-sep">:</div>
              <div class="seconds-input">00</div>

              <div class="{{ block.settings.text_class }}">Days</div>
              <div></div>
              <div class="{{ block.settings.text_class }}">Hrs</div>
              <div></div>
              <div class="{{ block.settings.text_class }}">Mins</div>
              <div></div>
              <div class="{{ block.settings.text_class }}">Secs</div>
            </div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>
  {% endif %}
{% endfor %}

{% endcapture %}

  
      {{ section_blocks_to_show }}

<style>
  .countdown-block {
    font-size: 1rem;
    line-height: 1rem;
  }
  @media (min-width: 768px) {
    .countdown-block {
      font-size: 1.6rem;
      line-height: 1.6rem;
    }
  
  }
</style>

{% schema %}
{
  "name": "Unified Countdown Section",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Default Background Color", "default": "#ffffff" },
    { "type": "color", "id": "text_color", "label": "Default Text Color", "default": "#000000" },
    { "type": "text", "id": "section_custom_classes", "label": "Section Custom Classes" }
  ],
  "blocks": [
    {
      "type": "countdown_block",
      "name": "Countdown Block",
      "settings": [
        { "type": "color", "id": "bg_color", "label": "Block Background Color" },
        { "type": "color", "id": "text_color", "label": "Block Text Color" },

        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "textarea", "id": "paragraph_text", "label": "Paragraph text" },
        { "type": "text", "id": "button_text", "label": "Button text" },
        { "type": "url", "id": "button_link", "label": "Button link" },
        { "type": "text", "id": "button_class", "label": "Button custom classes", "default": "!rounded-full" },

        { "type": "text", "id": "date", "label": "Countdown Date (YYYY-MM-DD)" },
        { "type": "text", "id": "time", "label": "Countdown Time (HH:MM in 24hr format)" },
        { "type": "text", "id": "number_class", "label": "Number Custom Classes" },
        { "type": "text", "id": "text_class", "label": "Label Text Custom Classes" },

        { "type": "text", "id": "custom_class", "label": "Block Custom Classes" },

        { "type": "checkbox", "id": "show_on_all_markets", "default": true, "label": "Show On All Markets" },
        { "type": "text", "id": "markets_to_show_on", "label": "Markets to show on" },
        { "type": "text", "id": "markets_to_exclude_on", "label": "Markets to exclude on" },

        { "type": "checkbox", "id": "show_on_all_collections", "default": true, "label": "Show on all collections" },
        { "type": "collection_list", "id": "collections_to_show_on_using_default_listed", "label": "Collections to show on (default listed)" },
        { "type": "collection_list", "id": "collections_to_show_on_extras", "label": "Collections to show on (extras)" },
        { "type": "collection_list", "id": "collections_to_exclude_from_default_listed", "label": "Collections to exclude (default listed)" },
        { "type": "collection_list", "id": "collections_to_exclude_from_extras", "label": "Collections to exclude (extras)" }
      ]
    }
  ],
  "presets": [
    { "name": "Unified Countdown Section", "blocks": [ { "type": "countdown_block" } ] }
  ]
}
{% endschema %}
