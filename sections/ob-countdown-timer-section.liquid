{% assign show_timer = false %}
{% assign bg_color = section.settings.bg_color | default: 'transparent' %}
{% assign text_color = section.settings.text_color | default: 'inherit' %}
{% assign section_classes = section.settings.section_custom_classes | default: '' %}

<div class="w-full py-8 px-4 sm:px-6 lg:px-8 {{ section_classes }}" style="background-color: {{ bg_color }}; color: {{ text_color }};">
  <div class="max-w-5xl mx-auto text-center space-y-6">
    {% for block in section.blocks %}
      {% case block.type %}
        {% when 'title' %}
          <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold {{ block.settings.custom_class }}">{{ block.settings.text }}</h2>

        {% when 'paragraph' %}
          <p class="text-base sm:text-lg md:text-xl {{ block.settings.custom_class }}">{{ block.settings.text }}</p>

        {% when 'button' %}
          <a href="{{ block.settings.link }}" class="inline-block px-6 py-3 border border-current text-base font-semibold rounded hover:opacity-80 transition {{ block.settings.custom_class }}">
            {{ block.settings.text }}
          </a>

        {% when 'countdown_timer' %}
          {% assign now = 'now' | date: '%Y-%m-%d %H:%M' %}
          {% assign target = block.settings.date | append: ' ' | append: block.settings.time %}
          {% assign datetime = target | date: '%Y-%m-%d %H:%M' %}
          {% if now < datetime %}
            {% assign show_timer = true %}
            <div
              class="count-down max-w-4xl mx-auto pt-4"
              date-value="{{ block.settings.date }}"
              time-value="{{ block.settings.time }}"
            >
              <div class="grid grid-cols-7 gap-x-2 sm:gap-x-4 md:gap-x-6 text-center {{ block.settings.number_class }}">
                <div class="days-input">00</div>
                <div class="time-sep">:</div>
                <div class="hours-input">00</div>
                <div class="time-sep">:</div>
                <div class="minutes-input">00</div>
                <div class="time-sep">:</div>
                <div class="seconds-input">00</div>

                <div class="text-xs sm:text-sm md:text-base mt-2 col-span-1 {{ block.settings.text_class }}">Days</div>
                <div></div>
                <div class="text-xs sm:text-sm md:text-base mt-2 col-span-1 {{ block.settings.text_class }}">Hrs</div>
                <div></div>
                <div class="text-xs sm:text-sm md:text-base mt-2 col-span-1 {{ block.settings.text_class }}">Mins</div>
                <div></div>
                <div class="text-xs sm:text-sm md:text-base mt-2 col-span-1 {{ block.settings.text_class }}">Secs</div>
              </div>
            </div>
          {% endif %}
      {% endcase %}
    {% endfor %}
  </div>
</div>

{% schema %}
{
  "name": "New countdown section",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "text",
      "id": "section_custom_classes",
      "label": "Section Custom Classes",
    }
  ],
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Heading",
          "default": "Countdown Starts Now"
        },
        {
          "type": "text",
          "id": "custom_class",
          "label": "Custom CSS classes",
          "default": "marujo text-4xl"
        }
      ]
    },
    {
      "type": "paragraph",
      "name": "Paragraph",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Text",
          "default": "Join us as the countdown begins. Don't miss out!"
        },
        {
          "type": "text",
          "id": "custom_class",
          "label": "Custom CSS classes",
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Button Text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Button Link"
        },
        {
          "type": "text",
          "id": "custom_class",
          "label": "Custom CSS classes",
          "default": "!rounded-full"
        }
      ]
    },
    {
      "type": "countdown_timer",
      "name": "Countdown Timer",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "date",
          "label": "Countdown Date (YYYY-MM-DD)"
        },
        {
          "type": "text",
          "id": "time",
          "label": "Countdown Time (HH:MM in 24hr format)"
        },
        {
          "type": "text",
          "id": "number_class",
          "label": "Number Custom Classes"
        },
        {
          "type": "text",
          "id": "text_class",
          "label": "Label Text Custom Classes"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "New countdown section",
      "blocks": [
        { "type": "title" },
        { "type": "paragraph" },
        { "type": "countdown_timer" },
        { "type": "button" }
      ]
    }
  ]
}
{% endschema %}
