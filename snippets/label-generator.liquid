{% if product.available %}
  {%- capture label_tags -%}{%- for tag in product.tags -%}
  {%- assign dTag = tag | downcase -%}
  {%- if dTag contains 'label-' -%}
  {{- dTag -}},
    {%- endif -%}
  {%- endfor -%}{%- endcapture -%}
  {% assign label_tags = label_tags | downcase %}
  {% assign label_found = 'false' %}
  {% for object in shop.metaobjects.label_list.values %}
    {% assign objects = object.label.value %}
    {% for each in objects %}
        {% assign show_on_all = each.show_on_all_markets %}
        {% assign to_show_on = each.markets_to_show_on_ | replace: '[', ''| replace: '"', '' | replace: ']', '' | split: ',' %}
        {% assign to_exclude_from = each.markets_to_exclude_from | replace: '[', ''| replace: '"', '' | replace: ']', '' | split: ',' %}
        {% assign show = true %}
        
          
        {% if show_on_all == false %}
          {% if to_exclude_from != blank %}
            {% for market in to_exclude_from %}
              {% assign market_strip = market | strip %}
              {% assign market_downcase = market_strip | downcase %}
              {% if market_code == market_downcase %}
                {% assign show = "false" %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}      
          {% if show == true %}
            {% assign show = false %}
            {% for market in to_show_on %}
              {% assign market_strip = market | strip %}
              {% assign market_downcase = market_strip | downcase %}
              {% if market_code == market_downcase %}
                {% assign show = true %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endif %}
      
      {% if settings.theme_label_version == each.theme_version and show %}
        
        {% assign tag_match = each.tag_match | downcase %}
        {% if label_tags contains tag_match and label_found == 'false' %}
          {% if each.tag_match == 'label-sale-value-discount' %}
            {% if product.metafields.custom.comp_price > 0 and cart.currency.iso_code == 'GBP' %}
              {% assign discount = product.metafields.custom.comp_price | minus: product.price %}
              {% assign discount_val = product.metafields.custom.comp_price | minus: product.price %}
              {% assign discount_val = discount_val | money %}
              <div
                class="{% if template contains 'shop-the-look' %} shop-the-look-sticker{% endif %} {% if template contains 'product' %}product-label text-xs font-mulish sub-title   rounded-sm{% endif %}"
                style="padding:3px 10px;border-radius:3px;background:{{ each.bg_colour }};border:2px solid  {{ each.outline_colour }};color:{{ each.text_colour }}; box-shadow: 1px 1px 1px rgb(0 0 0 / 30%);"
                tag="{{ each.tag_match }}"
              >
               {{ "ob_label.save" | t }}{{ discount_val }}
              </div>
            {% endif %}

            {% if product.compare_at_price > product.price %}
                        {% assign label_found = 'true' %}
              {% assign discount = product.compare_at_price | minus: product.price %}
              {% assign discount_val = product.compare_at_price | minus: product.price %}
              {% assign discount_val = discount_val | money %}
              <div
                class="{% if template contains 'shop-the-look' %} shop-the-look-sticker{% endif %} {% if template contains 'product' %}product-label text-xs font-mulish sub-title   rounded-sm{% endif %}"
                style="padding:3px 10px;border-radius:3px;background:{{ each.bg_colour }};border:2px solid  {{ each.outline_colour }};color:{{ each.text_colour }}; box-shadow: 1px 1px 1px rgb(0 0 0 / 30%);"
                tag="{{ each.tag_match }}"
              >
                 {{ "ob_label.save" | t }} {{ discount_val }}
              </div>
            {% endif %}
          {% elsif each.tag_match == 'label-sale-percent-discount' %}
            {% if product.compare_at_price > product.price %}
                        {% assign label_found = 'true' %}
              {% assign discount = product.compare_at_price | minus: product.price %}
              {% assign discount = discount | times: 100 %}
              {% assign discount_val = discount | divided_by: product.compare_at_price %}
              {% if discount_val == 28 %}
                {% assign discount_val = 29 %}
              {% endif %}
              <div
                class="{% if template contains 'product' %}{% if template contains 'shop-the-look' %} shop-the-look-sticker{% endif %} product-label text-xs font-mulish sub-title   rounded-sm{% endif %}"
                style="width:fit-content; padding:3px 10px;border-radius:3px;background:{{ each.bg_colour }};border:2px solid  {{ each.outline_colour }};color:{{ each.text_colour }}; box-shadow: 1px 1px 1px rgb(0 0 0 / 30%);"
                tag="{{ each.tag_match }}"
              >
                {{ discount_val -}}%  {{ "ob_label.off_sale" | t }}
                
              </div>
            {% endif %}
          {% else %}
                      {% assign label_found = 'true' %}
            <div
              class="{% if template contains 'shop-the-look' %} shop-the-look-sticker{% endif %} {% if template contains 'product' %}product-label text-xs font-mulish sub-title   rounded-sm{% endif %}"
              style="width:fit-content; padding:3px 10px;border-radius:3px;background:{{ each.bg_colour }};border:2px solid  {{ each.outline_colour }};color:{{ each.text_colour }}; box-shadow: 1px 1px 1px rgb(0 0 0 / 30%);"
              tag="{{ each.tag_match }}"
            >
              {{ each.text | upcase }}
            </div>
          {% endif %}

        {% endif %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endif %}
